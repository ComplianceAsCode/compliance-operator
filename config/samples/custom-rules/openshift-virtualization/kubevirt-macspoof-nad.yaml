apiVersion: compliance.openshift.io/v1alpha1
kind: CustomRule
metadata:
  name: kubevirt-macspoof-enabled-for-nad
  namespace: openshift-compliance
spec:
  title: "Macspoof Filtering Must Be Enabled for all Network Attachment Definitions"
  id: macspoof_filtering_enabled_nad
  description: |-
    Mac spoof filtering is a feature that helps prevent man-in-the-middle
    attacks by verifying the authenticity of MAC addresses in network packets.
    By checking the MAC address of incoming packets, mac-spoof filtering can
    help ensure that only authorized devices are able to communicate with a
    particular device or network.
  failureReason: |-
    The '.spec.config.macspoofchk' field is missing or not set to true in the
    'NetworkAttachmentDefinition' resource.
  severity: Medium
  checkType: Platform
  scannerType: CEL
  inputs:
    - name: nadList
      kubernetesInputSpec:
        apiVersion: k8s.cni.cncf.io/v1
        resource: NetworkAttachmentDefinition
  expression: |
    nadList.all(s,
        has(s.spec.config.macspoofchk) &&
        s.spec.config.macspoofchk == true
    )
